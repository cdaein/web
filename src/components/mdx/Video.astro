---
// TODO:
// - apply width and height to figure wrapper to avoid layout shift.
//  - get-video-dimensions works.
//  - props passed in don't work. i think it's because of number vs. string in css var.
//  - what about attr passed to <video>? is it working?

// @ts-ignore
import getDimensions from "get-video-dimensions";

type Props = {
  /** Path string */
  src: string;
  caption?: string;
  width?: number;
  height?: number;
  autoplay?: boolean;
  /** Additional classes to add to the wrapper div */
  mb?: boolean;
  class?: string;
};
const {
  src,
  caption,
  width,
  height,
  autoplay,
  mb,
  class: className,
} = Astro.props;

const dimensions = await getDimensions(`.${src}`);

const w = width || dimensions.width;
const h = height || dimensions.height;
---

<style is:global define:vars={{ w, h }}>
  figure.video-wrapper video {
    width: 100%;
    aspect-ratio: var(--w) / var(--h);
  }
</style>

<figure class:list={["video-wrapper mb-8 bg-black", mb && "mb-8", className]}>
  <video
    src={src}
    width={width}
    height={height}
    autoplay={autoplay}
    controls
    loop
    muted
    playsinline
    class:list={["w-full h-full object-cover"]}
  >
  </video>
  {caption && <figcaption>{caption}</figcaption>}
</figure>
