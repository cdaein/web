---
import data from "@data/activities";
import ActivityListItem from "@components/mdx/ActivityListItem.astro";
import type { Activity } from "@data/activities";

type Props = {
  slug: string;
  /** Show separate list per activity type */
  sortByType?: boolean;
};

const { slug, sortByType = false } = Astro.props;

const activities = data.filter((act: Activity) => act.slug === slug);

const sortedActivities = activities.reduce(
  (acc: Record<Activity["type"], Activity[]>, activity) => {
    const { type } = activity;
    acc[type] = acc[type] || [];
    acc[type].push(activity);
    return acc;
  },
  {} as Record<Activity["type"], Activity[]>,
);

// all activity types (keys only)
const activityTypes = Object.keys(
  sortedActivities,
) as (keyof typeof sortedActivities)[];

const typeLUT = {
  award: "Awards",
  event: "Events",
  exhibition: "Exhibitions",
  featured: "Featured",
  interview: "Interviews",
  lecture: "Lectures",
  publication: "Publications",
  screening: "Screenings",
};

const mapHeader = (type: keyof typeof typeLUT) => typeLUT[type];
---

{
  sortByType ? (
    activityTypes.map((type) => (
      <section>
        <h1>{mapHeader(type)}</h1>
        <ul role="list">
          {sortedActivities[type].map((act) => (
            <ActivityListItem data={act} />
          ))}
        </ul>
      </section>
    ))
  ) : (
    <section>
      <ul role="list">
        {activities.map((act) => (
          <ActivityListItem data={act} />
        ))}
      </ul>
    </section>
  )
}
