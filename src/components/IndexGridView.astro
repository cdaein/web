---
import type { CollectionEntry } from "astro:content";
import IndexThumbnailItem from "@components/IndexThumbnailItem.astro";

type Props = {
  posts: CollectionEntry<"work">[];
  coverImages: Record<string, ImageMetadata>;
  class?: string;
};

const { posts, coverImages, class: className } = Astro.props;

// Helper to find cover image for a post
function findCoverImage(
  postId: string,
  cover?: string,
): ImageMetadata | undefined {
  if (!cover) return undefined;

  // postId is like "2024/240719-supercut/index.mdx"
  // cover is relative path like "./thumb.png"
  const postDir = postId.replace(/\/[^/]+$/, ""); // removes "/index.mdx"
  const coverPath = cover.replace(/^\.\//, "");
  const expectedPath = `/src/content/work/${postDir}/${coverPath}`;

  return coverImages[expectedPath];
}
---

<div
  id="index-grid-view"
  class:list={[
    "grid gap-0 px-0 border-l border-black",
    "grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8",
    "max-w-[3840px] m-auto",
    className,
  ]}
>
  {
    posts.map((post) => (
      <IndexThumbnailItem
        post={post}
        thumbnail={findCoverImage(post.id, post.data.cover)}
      />
    ))
  }
</div>
