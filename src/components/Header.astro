---
// NOTE:
// - header is 3-column grid
// - 1st: view toggle (on index) or name (on other pages)
// - 2nd: prev, index, next => inner structure
// - 3rd: about

import type { CollectionEntry } from "astro:content";
import { DEFAULT_VIEW } from "@data/constants"

type Props = {
  prevPost?: CollectionEntry<"work" | "writing">;
  nextPost?: CollectionEntry<"work" | "writing">;
  class?: string;
};

const { prevPost, nextPost, class: className } = Astro.props;
const pathname = Astro.url.pathname;
const isIndexPage = pathname === "/";


const viewToggleScript = /*javascript*/ `
  (function() {
    const DEFAULT_VIEW = '${DEFAULT_VIEW}';
    const gridIcon = document.getElementById('icon-grid');
    const listIcon = document.getElementById('icon-list');
    const savedView = localStorage.getItem('indexView') || DEFAULT_VIEW;

    // Flip icons if localStorage differs from default
    if (savedView !== DEFAULT_VIEW) {
      gridIcon?.classList.remove('opacity-30');
      listIcon?.classList.add('opacity-30');
    }

    document.addEventListener('DOMContentLoaded', () => {
      const toggleBtn = document.getElementById('view-toggle');
      if (toggleBtn) {
        const listView = document.getElementById('index-list-view');
        const gridView = document.getElementById('index-grid-view');

        toggleBtn.addEventListener('click', () => {
          const current = localStorage.getItem('indexView') || DEFAULT_VIEW;
          const newView = current === 'list' ? 'grid' : 'list';
          localStorage.setItem('indexView', newView);
          listView?.classList.toggle('hidden', newView === 'grid');
          gridView?.classList.toggle('hidden', newView === 'list');
          gridIcon?.classList.toggle('opacity-30', newView === 'list');
          listIcon?.classList.toggle('opacity-30', newView === 'grid');
        });
      }
    });
  })();
`;
---

<header
  class:list={[
    "fixed top-0 h-9 border-b-2 border-b-black bg-white w-full flex items-center z-10",
    "[&_a]:no-underline",
    className,
  ]}
>
  <nav
    role="navigation"
    aria-label="Main"
    class:list={[
      "grid grid-cols-12 w-full",
      "gap-x-2 md:gap-x-8",
      "max-w-screen-xl m-auto",
    ]}
  >
    {isIndexPage ? (
      <button
        id="view-toggle"
        class="group pl-4 col-start-1 col-end-3 flex justify-start items-center whitespace-nowrap cursor-pointer"
      >
        <span id="icon-grid" class:list={[DEFAULT_VIEW === 'list' && 'opacity-30']}>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18m-9-9h18"/><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
        </span>
        <span id="icon-list" class:list={[DEFAULT_VIEW === 'grid' && 'opacity-30']}>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path fill="none" d="M3 5h.01M3 12h.01M3 19h.01M8 5h13M8 12h13M8 19h13"/></svg>
        </span>
      </button>

      <div class="col-start-5 col-end-9 grid grid-cols-3">
        <span class="col-start-2 col-end-3 flex justify-center items-center">
          Index
        </span>
      </div>
    ) : (
      <a
        href="/"
        class="group pl-4 col-start-1 col-end-3 flex justify-start items-center whitespace-nowrap"
      >
        <span class="hidden md:block">paperdove.com</span>
        <span class="block md:hidden">pd</span>
      </a>

      <div class="col-start-5 col-end-9 grid grid-cols-3">
        {prevPost && (
          <a
            href=`/${prevPost.slug}`
            class="group col-start-1 col-end-2 flex justify-start items-center"
          >
            <span class="relative group-hover:right-1">←</span>&nbsp;
            <span class="hidden md:inline">Prev</span>
          </a>
        )}
        <a
          aria-label="Index"
          class="group col-start-2 col-end-3 flex justify-center items-center"
          href="/"
        >
          <span>Index</span>
        </a>
        {nextPost && (
          <a
            href=`/${nextPost.slug}`
            class="group col-start-3 col-end-4 flex justify-end items-center"
          >
            <span class="hidden md:inline">Next</span>&nbsp;
            <span class="relative group-hover:left-1">→</span>
          </a>
        )}
      </div>
    )}

    <a
      aria-label="About"
      class="group pr-4 col-start-12 col-end-13 flex justify-end items-center"
      href="/about"
    >
      <span class="block md:hidden">A</span>
      <span class="hidden md:block">About</span>
    </a>
  </nav>
</header>

<script is:inline set:html={viewToggleScript} />
